module accelerometer_driver(CLK12M, SDO, SDI, SPC, CS, out);
    input CLK12M, SDO;
    output SDI;
    output SPC;
    output CS;
    output [7:0] out;

    reg SPC = 1'b1;
    reg SDI = 1'b1;
    reg CS = 1'b0;
    reg [7:0] out = 8'b10101010;
    reg [3:0] cnt = 5'b00000;
    reg RW = 1'b1;
    reg MS = 1'b0;
    reg [5:0] AD = 6'b001111;
    reg [7:0] DI = 8'b00000000;
    reg [7:0] DO = 8'b10101010;

    reg CLK6M = 1'b1;

    reg [15:0] in_data;

    always @(posedge CLK12M) begin
        if(CS == 0) begin
            SPC <= ~SPC;
        end
        in_data <= {RW, MS, AD, DI};
    end

    always @(posedge CLK12M) begin
        CLK6M <= ~CLK6M;
    end

    always @(negedge CLK6M) begin
        if(cnt == 0) begin
            CS <= 1'b0;
            out <= out;
            cnt = cnt + 4'b1;
        end else if(0 < cnt && cnt < 17) begin
            SDI <= in_data[4'd16 - cnt];
            if(cnt > 8) begin
                DO[4'd16 - cnt] <= SDO;
            end else begin
                DO <= DO;
                out <= DO;
            end
            cnt <= cnt + 4'b1;
        end else begin
            out <= out;
            cnt <= 4'b0;
            CS <= 1'b1;
            SDI <= 1'b1;
        end
    end
endmodule
