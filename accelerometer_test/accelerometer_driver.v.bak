module accelerometer_driver(CLK12M, SDO, SDI, SPC, CS, out);
    input CLK12M, SDO;
    output SDI;
    output SPC;
    output CS;
    output [7:0] out;

    reg SPC = 1'b1;
    reg CS = 1'b1;
    reg [7:0] out = 8'b00000000;
    reg [3:0] cnt = 4'b0000;
    reg RW = 1'b0;
    reg MS = 1'b1;
    reg [5:0] AD = 6'b101001;
    reg [7:0] DI = 8'b00000000;
    reg [7:0] DO;

    reg [15:0] in_data;
    reg [7:0] out_data;

    always @(posedge CLK12M) begin
        SPC <= ~SPC;
        in_data <= {RW, MS, AD, DI};
    end

    always @(negedge SPC) begin
        SDI <= in_data[4'd15 - cnt];
        if(cnt > 7) begin
            out_data[4'd15 - cnt] <= SDO;
            out <= out_data;
        end else begin
            out_data <= out_data;
            out <= out_data;
        end
        cnt <= cnt + 4'b1;
        if(cnt == 15) begin
            cnt <= 4'd0;
            CS <= 1'b1;
        end else if(cnt == 0) begin
            CS <= 1'b0;
        end else begin
            CS <= CS;
        end
    end
endmodule
